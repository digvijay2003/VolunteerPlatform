<body class="d-flex flex-column min-vh-100">
  <div class="flex-grow-1 d-flex align-items-center justify-content-center py-5" 
       style="background: linear-gradient(to bottom right, #d3ecf3, #9dc5d6);">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-xl-10 col-lg-11">
          <div class="card shadow-lg rounded-4 border-0" style="background-color: rgba(255, 255, 255, 0.95);">
            <div class="card-body p-4 p-md-5">
              <h2 class="text-center mb-5 text-primary fw-bold"><%= title %></h2>

              <div class="alert alert-info border-0 rounded-3 shadow-sm mb-4" role="alert">
                <h5 class="alert-heading fs-6 fw-bold mb-2">Heads Up! Important Information:</h5>
                <p class="mb-2"><strong>Please ensure all required fields are accurately filled.</strong> We have some specific validation rules to keep things smooth:</p>
                <ul class="mb-0 ps-3">
                  <li><i class="bi bi-person-fill"></i> Your **Username** needs to be at least 3 characters long.</li>
                  <li><i class="bi bi-phone-fill"></i> **Phone** number should follow the format `+91 98050xxxxx` (or a similar international format).</li>
                  <li><i class="bi bi-file-earmark-arrow-up-fill"></i> **Government ID** file size must be 100KB or less.</li>
                  <li><i class="bi bi-lock-fill"></i> Your **Password** must be 8 characters or more.</li>
                  <li><i class="bi bi-envelope-fill"></i> A **Valid Email** address is required.</li>
                  <li><i class="bi bi-geo-alt-fill"></i> We need to know your **Location** and **Availability**.</li>
                  <li><i class="bi bi-person-badge-fill"></i> **Emergency Contact Name** is a mandatory field.</li>
                </ul>
              </div>

              <form action="<%= action %>" method="POST" enctype="multipart/form-data" id="volunteer-registration-form" class="needs-validation" novalidate>
                <div class="row g-4">
                  <% fields.forEach(field => { %>
                    <div class="col-md-6 col-lg-4">
                      <% if (field.type === 'select') { %>
                        <label for="<%= field.id %>" class="form-label fw-semibold"><%= field.label %></label>
                        <select class="form-select" id="<%= field.id %>" name="<%= field.name %>" <%= field.multiple ? 'multiple' : '' %> <%= field.required ? 'required' : '' %> aria-describedby="<%= field.id %>Help">
                          <option selected disabled value="">Choose...</option>
                          <% field.options.forEach(option => { %>
                            <option value="<%= option.value %>"><%= option.label %></option>
                          <% }) %>
                        </select>
                        <% if (field.description) { %>
                          <div id="<%= field.id %>Help" class="form-text"><%= field.description %></div>
                        <% } %>
                        <div class="invalid-feedback">Please select a valid <%= field.label.toLowerCase() %>.</div>

                      <% } else if (field.type === 'file') { %>
                        <label for="<%= field.id %>" class="form-label fw-semibold"><%= field.label %></label>
                        <input type="file" class="form-control" id="<%= field.id %>" name="<%= field.name %>" <%= field.multiple ? 'multiple' : '' %> <%= field.required ? 'required' : '' %> aria-describedby="<%= field.id %>Help">
                        <div id="<%= field.id %>Help" class="form-text"><%= field.description || 'Accepted formats: JPG, PNG, PDF. Max size: 100KB.' %></div>
                        <div class="invalid-feedback" id="<%= field.id %>-error">Please upload a valid file (JPG, PNG, PDF, max 100KB).</div>

                      <% } else { %>
                        <label for="<%= field.id %>" class="form-label fw-semibold"><%= field.label %></label>
                        <input type="<%= field.type %>" class="form-control" id="<%= field.id %>" name="<%= field.name %>" value="<%= field.value || '' %>" <%= field.attributes || '' %> <%= field.required ? 'required' : '' %> aria-describedby="<%= field.id %>Help">
                        <% if (field.description) { %>
                          <div id="<%= field.id %>Help" class="form-text"><%= field.description %></div>
                        <% } %>
                        <div class="invalid-feedback">
                          <% if (field.id === 'username') { %>
                            Username must be at least 3 characters.
                          <% } else if (field.id === 'email') { %>
                            Please enter a valid email address.
                          <% } else if (field.id === 'password') { %>
                            Password must be at least 8 characters.
                          <% } else if (field.id === 'phone') { %>
                            Please enter a valid phone number (e.g., +91 98050xxxx).
                          <% } else { %>
                            This field is required.
                          <% } %>
                        </div>
                      <% } %>
                    </div>
                  <% }) %>
                </div>

                <div class="text-center mt-5">
                  <button type="submit" class="btn btn-primary btn-lg px-5 shadow-sm rounded-pill">
                    <%= submitLabel || 'Register Now' %> <i class="bi bi-arrow-right-short"></i>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eZGBYHT1L" crossorigin="anonymous"></script>
  <script>
    (function () {
      'use strict'

      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      const forms = document.querySelectorAll('.needs-validation')

      // Loop over them and prevent submission
      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          if (!form.checkValidity()) {
            event.preventDefault()
            event.stopPropagation()
          }

          const fileInput = document.getElementById("governmentIdProofs");
          const fileErrorDiv = document.getElementById("governmentIdProofs-error");

          if (fileInput) {
            const files = fileInput.files;
            fileErrorDiv.textContent = ''; // Clear previous errors

            let fileInvalid = false;
            for (let file of files) {
              if (file.size > 100 * 1024) {
                fileErrorDiv.textContent = "File size must not exceed 100KB.";
                fileInvalid = true;
                break;
              }

              if (!['image/png', 'image/jpg', 'image/jpeg', 'application/pdf'].includes(file.type)) {
                fileErrorDiv.textContent = "Only PNG, JPG, JPEG, and PDF files are allowed.";
                fileInvalid = true;
                break;
              }
            }

            if (fileInvalid) {
              event.preventDefault();
              event.stopPropagation();
              fileInput.classList.add('is-invalid');
            } else {
              fileInput.classList.remove('is-invalid');
            }
          }

          form.classList.add('was-validated')
        }, false)
      })
    })();
  </script>