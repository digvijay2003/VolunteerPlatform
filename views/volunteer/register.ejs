<div class="d-flex align-items-center justify-content-center"
     style="min-height: 100vh; background: white;">
  <div class="container-fluid mx-3" style="width: 100%; background: rgba(255, 255, 255, 0.92); border-radius: 1rem; box-shadow: 0 8px 24px rgba(0,0,0,0.1); padding: .3rem; backdrop-filter: blur(8px);">


    <div class="d-flex justify-content-between align-items-center mb-4">
      <a href="/feedhope" class="btn btn-outline-dark me-2">
        <span class="material-symbols-outlined align-middle">arrow_back</span> Back to Home
      </a>
      <a href="/volunteer-login" class="btn btn-primary">
        Volunteer Login
      </a>
    </div>

    <h2 class="text-center fw-bold mb-3"
        style="color: #031d38; font-size: 2.25rem; letter-spacing: -0.5px;"> <%= title %> </h2>

    <%- include('../partials/volunteerGuidelines') %>

    <form action="<%= action %>" method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
      <div class="row g-4">
        <% fields.forEach(field => { %>
          <div class="col-md-6 col-lg-12">
            <label for="<%= field.id %>" class="form-label fw-semibold" style="font-weight: 700; color: #343a40; font-size: 1.3rem;"><%= field.label %></label>
            <% if (field.type === 'select') { %>
              <select id="<%= field.id %>" name="<%= field.name %>" class="form-select form-control-lg border border-dark p-2 mb-2 rounded-0 border-2"
                      <%= field.multiple ? 'multiple' : '' %>
                      <%= field.required ? 'required' : '' %>
                      style="border-radius: 0.5rem; padding: 0.65rem 1.25rem;">
                <option selected disabled value="">Choose...</option>
                <% field.options.forEach(option => { %>
                  <option value="<%= option.value %>"><%= option.label %></option>
                <% }) %>
              </select>
              <% if (field.description) { %>
                <div class="form-text" style="font-weight: 700; color: #343a40; font-size: 1.3rem;"><%= field.description %></div>
              <% } %>
              <div class="invalid-feedback">Please select a valid <%= field.label.toLowerCase() %>.</div>

            <% } else if (field.type === 'file') { %>
              <input type="file" class="form-control form-control-lg border border-dark p-2 mb-2 rounded-0 border-2" id="<%= field.id %>" name="<%= field.name %>"
                     <%= field.multiple ? 'multiple' : '' %> <%= field.required ? 'required' : '' %>
                     style="border-radius: 0.5rem; padding: 0.65rem 1.25rem;">
              <div class="form-text" style="font-weight: 700; color: #343a40; font-size: 1.3rem;">
                <%= field.description || 'Accepted formats: JPG, PNG, PDF. Max size: 100KB.' %>
              </div>
              <div class="invalid-feedback">Please upload a valid file.</div>

            <% } else { %>
              <input type="<%= field.type %>" class="form-control form-control-lg border border-dark p-2 mb-2 rounded-0 border-2"
                     id="<%= field.id %>" name="<%= field.name %>"
                     value="<%= field.value || '' %>" <%= field.attributes || '' %>
                     <%= field.required ? 'required' : '' %>
                     style="border-radius: 0.5rem; padding: 0.65rem 1.25rem;">
              <% if (field.description) { %>
                <div class="form-text" style="font-weight: 700; color: #343a40; font-size: 1.3rem;"><%= field.description %></div>
              <% } %>
              <div class="invalid-feedback">
                <% if (field.id === 'username') { %>
                  Username must be at least 3 characters.
                <% } else if (field.id === 'email') { %>
                  Please enter a valid email address.
                <% } else if (field.id === 'password') { %>
                  Password must be at least 8 characters.
                <% } else if (field.id === 'phone') { %>
                  Valid phone format required.
                <% } else { %>
                  This field is required.
                <% } %>
              </div>
            <% } %>
          </div>
        <% }) %>
      </div>

      <div class="text-center my-3 d-grid gap-2 col-12 mx-auto">
        <button type="submit" class="btn btn-primary btn-lg px-5 rounded-pill shadow-sm">Register Now</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eZGBYHT1L" crossorigin="anonymous"></script>
<script>
    (function () {
      'use strict'

      const forms = document.querySelectorAll('.needs-validation')

      Array.from(forms).forEach(form => {
        form.addEventListener('submit', event => {
          form.querySelectorAll('.invalid-feedback').forEach(feedback => {
              feedback.textContent = '';
          });

          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
            form.querySelectorAll(':invalid').forEach(field => {
                const feedbackDiv = field.nextElementSibling; 
                if (feedbackDiv && feedbackDiv.classList.contains('invalid-feedback')) {
                    if (field.id === 'username') {
                        feedbackDiv.textContent = 'Username must be at least 3 characters.';
                    } else if (field.id === 'email') {
                        feedbackDiv.textContent = 'Please enter a valid email address.';
                    } else if (field.id === 'password') {
                        feedbackDiv.textContent = 'Password must be at least 8 characters.';
                    } else if (field.id === 'phone') {
                        feedbackDiv.textContent = 'Please enter a valid phone number (e.g., +91 98050xxxx).';
                    } else if (!feedbackDiv.textContent) { 
                        feedbackDiv.textContent = 'This field is required.';
                    }
                }
            });
          }

          const fileInput = document.getElementById("governmentIdProofs");
          const fileErrorDiv = document.getElementById("governmentIdProofs-error");

          if (fileInput) {
            const files = fileInput.files;
            fileErrorDiv.textContent = '';
            fileInput.classList.remove('is-invalid'); 

            let fileInvalid = false;
            if (files.length === 0 && fileInput.required) {
                fileErrorDiv.textContent = "Please upload a file for Government ID.";
                fileInvalid = true;
            } else {
                for (let file of files) {
                    if (file.size > 100 * 1024) {
                        fileErrorDiv.textContent = "File size must not exceed 100KB.";
                        fileInvalid = true;
                        break;
                    }

                    if (!['image/png', 'image/jpg', 'image/jpeg', 'application/pdf'].includes(file.type)) {
                        fileErrorDiv.textContent = "Only PNG, JPG, JPEG, and PDF files are allowed.";
                        fileInvalid = true;
                        break;
                    }
                }
            }
            

            if (fileInvalid) {
              event.preventDefault();
              event.stopPropagation();
              fileInput.classList.add('is-invalid');
            } else {
              fileInput.classList.remove('is-invalid');
            }
          }
          
          form.classList.add('was-validated');
        }, false); 
      });
    })();
</script>